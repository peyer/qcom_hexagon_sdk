<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>QHL: QHDSP filter routines</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">QHL
   &#160;<span id="projectnumber">v1.0.0</span>
   </div>
   <div id="projectbrief">QualcommHexagonLibraries</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="modules.html"><span>Modules</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">QHDSP filter routines<div class="ingroups"><a class="el" href="group__qhdsp__library.html">QHDSP library</a></div></div>  </div>
</div><!--header-->
<div class="contents">

<p>Filter routines from QHDSP library.  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ga67fb527816e3a6912df2bc7f819377e2"><td class="memItemLeft" align="right" valign="top">int32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__qhdsp__filter__routines.html#ga67fb527816e3a6912df2bc7f819377e2">qhdsp_fir_h</a> (int16_t *in_samples, int16_t *coefs, uint32_t taps, uint32_t length, int16_t *out_samples)</td></tr>
<tr class="memdesc:ga67fb527816e3a6912df2bc7f819377e2"><td class="mdescLeft">&#160;</td><td class="mdescRight">FIR filtering on a bulk of data - 16b fixed-point.  <a href="#ga67fb527816e3a6912df2bc7f819377e2">More...</a><br /></td></tr>
<tr class="separator:ga67fb527816e3a6912df2bc7f819377e2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga90fad3f30ce8583fae18c5959b41b960"><td class="memItemLeft" align="right" valign="top">int32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__qhdsp__filter__routines.html#ga90fad3f30ce8583fae18c5959b41b960">qhdsp_fir_f</a> (const float *in_samples, float *delay_line, const float *coefs, uint32_t taps, uint32_t length, float_a8_t *out_samples)</td></tr>
<tr class="memdesc:ga90fad3f30ce8583fae18c5959b41b960"><td class="mdescLeft">&#160;</td><td class="mdescRight">FIR filtering on a bulk of data - float-point.  <a href="#ga90fad3f30ce8583fae18c5959b41b960">More...</a><br /></td></tr>
<tr class="separator:ga90fad3f30ce8583fae18c5959b41b960"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga11678857030ae6379dbfe4483450353a"><td class="memItemLeft" align="right" valign="top">int32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__qhdsp__filter__routines.html#ga11678857030ae6379dbfe4483450353a">qhdsp_iir_f</a> (const float *in_samples, const float *coefs, float *states, uint32_t num_biquads, uint32_t length, float *out_samples)</td></tr>
<tr class="memdesc:ga11678857030ae6379dbfe4483450353a"><td class="mdescLeft">&#160;</td><td class="mdescRight">IIR (cascaded biquad) filtering on a bulk of data - float-point.  <a href="#ga11678857030ae6379dbfe4483450353a">More...</a><br /></td></tr>
<tr class="separator:ga11678857030ae6379dbfe4483450353a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gad2e24ca3b1d0471a7d57397788aae2a4"><td class="memItemLeft" align="right" valign="top">int32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__qhdsp__filter__routines.html#gad2e24ca3b1d0471a7d57397788aae2a4">qhdsp_iir_h</a> (const int16_t *in_samples, const int16_t *coefs, int64_t *states, uint32_t num_biquads, uint32_t length, int16_t *out_samples)</td></tr>
<tr class="memdesc:gad2e24ca3b1d0471a7d57397788aae2a4"><td class="mdescLeft">&#160;</td><td class="mdescRight">IIR (cascaded biquad) filtering on a bulk of data - 16-bit fixed-point.  <a href="#gad2e24ca3b1d0471a7d57397788aae2a4">More...</a><br /></td></tr>
<tr class="separator:gad2e24ca3b1d0471a7d57397788aae2a4"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>Filter routines from QHDSP library. </p>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="ga90fad3f30ce8583fae18c5959b41b960"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t qhdsp_fir_f </td>
          <td>(</td>
          <td class="paramtype">const float *&#160;</td>
          <td class="paramname"><em>in_samples</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float *&#160;</td>
          <td class="paramname"><em>delay_line</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const float *&#160;</td>
          <td class="paramname"><em>coefs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>taps</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>length</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float_a8_t *&#160;</td>
          <td class="paramname"><em>out_samples</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>FIR filtering on a bulk of data - float-point. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">in_samples</td><td>- input samples in time domain </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">delay_line</td><td>- delay buffer (size is taps samples) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">coefs</td><td>- FIR filter coefficients </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">taps</td><td>- number of filter taps </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">length</td><td>- length of input/output data (number of samples) </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">out_samples</td><td>- output buffer </td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Note</dt><dd><ul>
<li>Assumptions:<ol type="1">
<li>out_samples aligned by 8 bytes </li>
</ol>
</li>
</ul>
</dd></dl>

</div>
</div>
<a class="anchor" id="ga67fb527816e3a6912df2bc7f819377e2"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t qhdsp_fir_h </td>
          <td>(</td>
          <td class="paramtype">int16_t *&#160;</td>
          <td class="paramname"><em>in_samples</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int16_t *&#160;</td>
          <td class="paramname"><em>coefs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>taps</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>length</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int16_t *&#160;</td>
          <td class="paramname"><em>out_samples</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>FIR filtering on a bulk of data - 16b fixed-point. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">in_samples</td><td>- input samples in time domain (Q15 format) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">coefs</td><td>- FIR filter coefficients (Q15 format) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">taps</td><td>- number of filter taps </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">length</td><td>- length of input/output data (number of samples) </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">out_samples</td><td>- output buffer (Q15 format) </td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Note</dt><dd><ul>
<li>Assumptions:<ol type="1">
<li>in_samples, coefs and out_samples aligned by 8 bytes</li>
<li>coefficients arranged in reversed order</li>
<li>in_samples buffer has to be of (taps + length) size</li>
<li>new incoming samples stored at [taps-1] offset in in_samples buffer </li>
</ol>
</li>
</ul>
</dd></dl>

</div>
</div>
<a class="anchor" id="ga11678857030ae6379dbfe4483450353a"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t qhdsp_iir_f </td>
          <td>(</td>
          <td class="paramtype">const float *&#160;</td>
          <td class="paramname"><em>in_samples</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const float *&#160;</td>
          <td class="paramname"><em>coefs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float *&#160;</td>
          <td class="paramname"><em>states</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>num_biquads</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>length</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float *&#160;</td>
          <td class="paramname"><em>out_samples</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>IIR (cascaded biquad) filtering on a bulk of data - float-point. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">in_samples</td><td>- input samples in time domain </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">coefs</td><td>- IIR filter coefficients - arranged as b0, b1, a1, b2, a2 </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">states</td><td>- pointer to filter states buffer </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">num_biquads</td><td>- number of consecutive IIR filter calls (with different coeffs) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">length</td><td>- length of input/output data (number of samples) </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">out_samples</td><td>- output buffer </td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Note</dt><dd><ul>
<li>Assumptions:<ol type="1">
<li>states buffer should be aligned to 8 bytes </li>
</ol>
</li>
</ul>
</dd></dl>

</div>
</div>
<a class="anchor" id="gad2e24ca3b1d0471a7d57397788aae2a4"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t qhdsp_iir_h </td>
          <td>(</td>
          <td class="paramtype">const int16_t *&#160;</td>
          <td class="paramname"><em>in_samples</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int16_t *&#160;</td>
          <td class="paramname"><em>coefs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int64_t *&#160;</td>
          <td class="paramname"><em>states</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>num_biquads</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>length</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int16_t *&#160;</td>
          <td class="paramname"><em>out_samples</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>IIR (cascaded biquad) filtering on a bulk of data - 16-bit fixed-point. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">in_samples</td><td>- input samples in time domain (Q15 format) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">coefs</td><td>- IIR filter coefficients - arranged as b0, b1, a1, b2, a2 (Q15 format) and shift_amt (int16) </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">states</td><td>- pointer to filter states buffer (Q47 format) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">num_biquads</td><td>- number of consecutive IIR filter calls (with different coeffs) - valid range 1-5 </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">length</td><td>- length of input/output data (number of samples) </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">out_samples</td><td>- output buffer (Q15 format) </td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Note</dt><dd><pre class="fragment">                 Cascade of biquads, i.e. transfer function of:

                            b0 + b1*z^-1 + b2*z^-2
                    H(z) = -----------------------
                            a0 + a1*z^-1 + a2*z^-2

                 for each biquad in the filter. This implementation uses 5 instead
                 of 6 coefficients (all coefficients divided with a0 coefficient).
                 Also, a1 and a2 coeffs are stored with - sign and divided by 2.0,
                 so transfer function looks like this:

                            (b0/a0) +        (b1/a0)*z^-1 +        (b2/a0)*z^-2
                    H(z) = -----------------------------------------------------
                               1    + 2*(-a1/(2*a0))*z^-1 + 2*(-a2/(2*a0))*z^-2

                 If any of b0/a0, b1/a0 or b2/a0 coefficients are greater than 1.0 (abs value),
                 all three coefficients are divided with next larger power of 2.
                 Additionally, at the end of coefficients buffer, shift amount is
                 stored to compensate division of these three coefficients. If these
                 were not larger than 1.0, shift amount should be set to 0. Shift amount
                 is always &gt;=0.
                 Transfer function if any of b0/a0, b1/a0 or b2/a0 coefficients are greater than
                 1.0 (abs value):

                                        (b0/a0)/2^shift + (b1/a0)/2^shift*z^-1 + (b2/a0)/2^shift*z^-2
                    H(z) = (2^shift) * ----------------------------------------------------------------
                                         1              + 2*(-a1/(2*a0))*z^-1  + 2*(-a2/(2*a0))*z^-2


                 Coefficients are stored in following order:
                     b0/a0 (Q15 format), b1/a0 (Q15 format), -a1/(2*a0) (Q15 format)
                     b2/a0 (Q15 format), -a2/(2*a0) (Q15 format), shift_amount (int16)

                 Example 1:

                     Lowpass filter @2kHz, sample rate 48kHz, Q=0.707

                     b0/a0 = 0.01440110
                     b1/a0 = 0.02880221
                     b2/a0 = 0.01440110
                     a1/a0 = -1.63295501
                     a2/a0 = 0.69055942

                     Coeffs:
                         0x01d7,    // b0/a0 = 0.01440110
                         0x03af,    // b1/a0 = 0.02880221
                         0x6882,    // -(a1/(2*a0)) = 0.816477505
                         0x01d7,    // b2/a0 = 0.01440110
                         0xd3ce,    // -(a2/(2*a0)) = -0.34527971
                         0x0000     // shift amount

                 Example 2:

                     Lowshelf filter @2kHz, sample rate 48kHz, Q=0.707

                     b0/a0 = 1.01062062
                     b1/a0 = -1.63980490
                     b2/a0 = 0.69052203
                     a1/a0 = -1.64314011
                     a2/a0 = 0.69780744

                     max(abs(b0/a0), abs(b1/a0), abs(b2/a0)) = 1.63980490
                     all three "b" coefficients are divided by div=2.0
                     shift amount is log2(div) = 1

                     Coeffs:
                         0x40ae,    // b0/(2*a0) = 0.50531031
                         0x970e,    // b1/(2*a0) = -0.81990245
                         0x6929,    // -(a1/2*a0) = 0.821570055
                         0x2c31,    // b2/(2*a0) = 0.345261015
                         0xd358,    // -(a2/2*a0) = -0.34890372
                         0x0001     // shift amount
</pre> </dd></dl>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
