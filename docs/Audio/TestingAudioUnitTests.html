<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta content="text/html;charset=utf-8" http-equiv="Content-Type">
<style type="text/css">
table {
   border-collapse: collapse;
   border-width: 1px;
   border-spacing: 1px;
   border-color: transparent;
   margin: 16px 0;
   width: 100%;
}
th {
   background-color: #bbb; color: white;
}
td, th {
   border-style: solid;
   border-color: black;
   border-width: 1px;
   padding: 0 6px;
}
td p:first-child, th p:first-child {
   margin-top: 3px;
}
td p:last-child, th p:last-child {
   margin-bottom: 3px;
}

.smarkdoc {
  margin-left: 42px; margin-right: 42px;
  font-size: 13px;
  font-family: 'Lucida Grande', Geneva, Helvetica, Arial, sans-serif;
}

h1, h2, h3 { color: #3c4c6c; }
h1 {
  text-align: center;
  font-size: 200%;
/*    margin-left: -30px; */
  clear: both;
}
h2 {
  font-size: 160%;
  margin: 32px -40px 24px -42px;
  padding: 3px 24px 8px;
  border-bottom: 2px solid #5088c5;
  clear: both;
}
h3 {
  font-size: 130%;
  margin: 20px -4px 10px;
  padding: 4px;
  clear: both;
}
h4 {
  font-size: 110%;
  margin: 2em 0 1em;
}

pre {
  font-size: 90%;
  background-color: #f0f0f4; padding: 6px; border: 1px solid #d0d0ee;
  font-family: "Courier New", "Lucida Console", "Monaco", monospace;
}

.pre {
  font-size: 90%;
  padding: 6px;
  background-color: #f0f0f4;
  font-family: "Courier New", "Lucida Console", "Monaco", monospace;
}

code {
  font-size: 90%;
  font-family: "Courier New", "Lucida Console", "Monaco", monospace;
}

h3 code {
  font-size: 100%;
}

p {
  margin: 0.8em 0;
}
ul, ol {
  margin: 1em 0 1em 3em; padding: 0;
}
div.indent {
  margin: 0 3em;
}

a[href] {
  text-decoration: none;
  color: #2020b0;
}
a[href]:hover {
  border-bottom: 1px dotted #2030d0;
}

/* Smark Users Guide */

.codebox {
  padding: 0 1px;  margin-right:1px;
  border:1px solid #d0d0ee;
  background-color: #f0f0f4;
  font-weight: bold;
  font-family: "Courier New", "Lucida Console", "Monaco", monospace;
}

/* ================ Smark-specific classes ================ */

.indent {
  margin: 0 3em;
}

/*
|| Floats affect text flow but not block boundaries, so graphics in a DIV
|| would overlap floats if not for "clear: both"
*/
.diagram {
  margin: 18px 0;
  clear: both;
}

/* ASCII Art */

.art {
  margin-right: auto; margin-left: auto; /* center */
  font-family: Arial, Verdana, "Lucida Console", Monaco, monospace;
  font-weight: bold;
}
.art * {
   border-color: #543;
}
.art .dline, .art .drect {
   border-style: dotted;
}
.art .rect {
   -webkit-box-shadow: 0.2em 0.2em 0.3em rgba(0,0,0,0.3);
   -moz-box-shadow: 0.2em 0.2em 0.3em rgba(0,0,0,0.3);
   box-shadow: 0.2em 0.2em 0.2em #875;
   background-color: #f9faf4; /* #fafff4; #f8f8ec;  */
}
.art .nofx {
   background-color: #f9faf4;
}
.art .round {
   border-radius: 0.6em;
   -webkit-border-radius: 0.6em;
   -moz-border-radius: 0.6em;
}

/* .art .line {  -webkit-box-shadow: 0.1em 0.1em 0.2em rgba(0,0,0,0.3); } */

/* Sequence Charts */

.msc {
   font: 11px Verdana, Monaco, "Lucida Console";
   margin-left: auto; margin-right: auto;
   background-color: white;
   /* border: 1px solid #555; */  /* Useful for non-white pages */
}

/* Table of Contents */

.tocLevel {
  margin-left: 2em;
  font-weight: normal;
}
.tocLevel .tocLevel {
  font-size: 90%; /* ...of inherited font size */
  line-height: 150%; /* ...of font size */
}
.toc > .tocLevel {
  font-weight: bold;
  margin: 0.5em 0
}
.toc {
  column-count: 2; column-gap: 2em;
  -moz-column-count: 2; -moz-column-gap: 2em;
  -webkit-column-count: 2; -webkit-column-gap: 2em;
}

/* ordinary text content is in P elements */

td p:first-child, th p:first-child {
   margin-top: 3px;
}
td p:last-child, th p:last-child {
   margin-bottom: 3px;
}
li p:only-child {
  margin-top: 0;
  margin-bottom: 0;
}

/* ================ Print ================ */

@media print {

  @page {
    margin: 0.75in 0.75in;
    size: Letter;
    @bottom {
      content: counter(page);
      vertical-align: top;
      padding-top: 1em;
    }
  }
  h1 { text-align: center;
       margin: 3in 0 20px; }
  h2 { page-break-before: always; }
  h2 { string-set: section content() }
  .toc { margin: 3em -2em }
  .toc a::after {
     font-size: 10px;
     content: leader(' . ') "  " target-counter(attr(href), page);
  }
  table { page-break-inside: avoid; }
}

/* ================  Layout  ================ */
/*
 *  +------------------------+
 *  |         #header        |
 *  +----------+-------------+
 *  | #sidebar |  #content   |
 *  |          |             |
 *  +----------+-------------+
 *
 * CSS padding, border width, and border style (!) affect the actual height
 * (and in turn layout).
 */

#header {
  position: fixed;
  top: 0px;
  height: 32px;
  left: 0px;
  width: 100%;
  padding: 10px 10px 0 0;
}
#sidebar {
  position: fixed;
  top: 42px;
  bottom: 0px;
  left: 0px;
  min-width: 180px;
  overflow: auto;
  border: 1px solid transparent;
  border-width: 0 1px 0 1px;
  padding: 0px 5px 0px 5px;
}
#content {
  position: fixed;
  top: 60px;
  left: 200px;
  bottom: 0px;
  right: 0px;
  overflow: auto;
  -webkit-overflow-scrolling: touch;
  padding: 10px 20px;
  padding-top: 0;
}

/* ================  Styles  ================ */


body {
  font-family: "Lucida Grande", Helvetica, Arial, sans-serif;
  font-size: 16px;
}

#header {
  color: #fff;
  background: #555;
  text-align: center;
  font-size: 25px;
}

#sidebar {
  color: #000;
  background: #eee;
  border-right: 1px solid #bbb;
  text-align: left;
  font-size: 12px;
  line-height: 50%;
}

#sidebar h1 {
  margin: 0 0 0 0;
  border-left: 5px solid transparent;
  text-align: left;
  font-size: 12px;
  /*text-shadow: #fff 1px 0px;*/
  line-height: 1%;
}

#sidebar h2 {
  margin: 2px 0 8px 0;
  border-left: 5px solid transparent;
  text-align: center;
  font-size: 12px;
  /*text-shadow: #fff 1px 0px;*/
  line-height: 1%;
}



#content {
  margin: 0;
  font-size: 13px;
  line-height: 160%;
}

#content h1, #content h2 {
  border-bottom: 2px solid;
  font-size: 1.8em;
  font-weight: normal;
  margin: 2.0em 0px 1.3em 0px;
  padding-bottom: 0.6em;
  text-align: left;
}

#content h3 {
  color: #242220;
  font-size: 1.4em;
  font-weight: normal;
  margin: 2em 0px 0.8em 0px;
  text-shadow: #FFFFFF 0px 1px 1px;
}
#content h4 {
  font-size: 1.2em;
  font-weight: normal;
  margin: 2em 0px 0.5em 0px;
  text-shadow: #FFFFFF 0px 1px 1px;
}

a[href] {
  color: #05c;
  text-decoration: none;
}

#sidebar a {
  /*text-shadow:  1px 1px 2px #fff, -1px -1px #ddd;*/
  line-height: 40%;
}

pre, code {
  font-family: "Courier New", "Lucida Console", "Monaco", monospace;
  font-family: "Monaco", monospace;  font-size: 90%;
  background-color: #f8f8fa;
  border: 1px solid #e4e4ee;
  -webkit-border-radius: 2px;
  -moz-border-radius: 2px;
  border-radius: 2px;
  padding: 1px 0 0 1px;
}

pre {
  padding: 2px 4px;
}

table {
   border-collapse: collapse;
   border-width: 1px;
   border-spacing: 1px;
   border-color: transparent;
   margin: 16px 0;
   width: 100%;
}
th {
   background-color: #bbb; color: white;
}
td, th {
   border-style: solid;
   border-color: black;
   border-width: 1px;
   padding: 0 6px;
}

/* Highlight currently-selected sidebar link */

#sidebar a.thisfile {
  color: #557;
}

/* indentation */

#content {
   padding-left: 60px;
}
#content h1, 
#content h2, 
#content h3, h4 {
    margin-left: -30px;
}

h3 > code {
    font-size: 80%;
}

/* ================ Smark-specific classes ================ */

.indent {
  margin: 0 3em;
}

/*
|| Floats affect text flow but not block boundaries, so graphics in a DIV 
|| would overlap floats if not for "clear: both"
*/
.diagram {
  margin: 18px 0;
  clear: both;
}

/* ASCII Art */

.art {
  margin-right: auto; margin-left: auto; /* center */
  font-family: Arial, Verdana, "Lucida Console", Monaco, monospace;
  font-weight: bold;
}
.art * {
   border-color: #543;
}
.art .dline, .art .drect {
   border-style: dotted;
}
.art .rect {
   -webkit-box-shadow: 0.2em 0.2em 0.3em rgba(0,0,0,0.3);
   -moz-box-shadow: 0.2em 0.2em 0.3em rgba(0,0,0,0.3);
   box-shadow: 0.2em 0.2em 0.2em #875;
   background-color: #f9faf4; /* #fafff4; #f8f8ec;  */
}
.art .nofx {
   background-color: #f9faf4;
}
.art .round {
   border-radius: 0.6em;
   -webkit-border-radius: 0.6em;
   -moz-border-radius: 0.6em;
}

/* Sequence Charts */

.msc {
   font: 11px Verdana, Monaco, "Lucida Console"; 
   margin-left: auto; margin-right: auto;
   background-color: white;
   border: 1px solid #555;
}

/* Table of Contents */

.tocLevel {
  margin-left: 2em;
  font-weight: normal;
}
.tocLevel .tocLevel {
  font-size: 90%; /* ...of inherited font size */
  line-height: 150%; /* ...of font size */
}
/*
.toc > .tocLevel {
  font-weight: bold;
  margin: 0.5em 0
}
*/

.toc {
  column-count: 1; column-gap: 2em;
  -moz-column-count: 1; -moz-column-gap: 2em;
  -webkit-column-count: 1; -webkit-column-gap: 2em; 
   alternate: column-width: 235px; column-rule-width: 5px;
}


.columns {
  column-count: 2; column-gap: 2em;
  -moz-column-count: 2; -moz-column-gap: 2em;
  -webkit-column-count: 2; -webkit-column-gap: 2em; p
}

/* ordinary text content is in P elements */

td p:first-child, th p:first-child {
   margin-top: 3px;
}
td p:last-child, th p:last-child {
   margin-bottom: 3px;
}
li p:only-child {
  margin-top: 0;
  margin-bottom: 0;
}


/* ================ Print ================ */

@media print {

  #header, #content { position: static; }
  #sidebar { display: none; }

  @page {
    margin: 0.75in 0.75in;
    size: Letter;
    @bottom {
      content: counter(page);
      vertical-align: top;
      padding-top: 1em;
    }
  }
  h1 { text-align: center;
       margin: 1in 0 1in; }
  h2 { page-break-before: always; }
  h2 { string-set: section content() }
  .toc { margin: 3em 0 }
  .toc a::after {
     font-size: 10px;
     content: leader(' . ') "  " target-counter(attr(href), page);
  }
  table { page-break-inside: avoid; }
}


</style><style type="text/css">
.search { right: 20pt; position: fixed; top: 5pt }

</style><title>Audio unit testing</title>
</head><body>
<div class="smarkdoc"><div id="header">Hexagon SDK 3.5.4</div><div id="sidebar"><top><img src="../images/sidebar_top.jpg"></top><script src="../scripts/post.js" type="text/javascript"></script><form class="search" id="searchForm"><input id="searchquery" name="q" onkeydown="postFunctionKeydown(event, true)"><input id="searchButton" onclick="postFunction(true)" type="button" value="Search"></form><p>
<a href="../index.html">Quick start</a>
</p><hr>
<p>
<a href="../feature_matrix.html">Feature Matrix</a>
</p><hr>
<p>
<a href="../hexagon_architecture.html">Hexagon Architecture</a>
</p><hr>
<p>
<a href="../images/Hexagon_Document_Bundle.pdf#page=2881">Hexagon Compiler/Linker</a>
</p><hr>
<p>
<a href="../hexagon_libraries.html">Hexagon Standard Libraries</a>
</p><hr>
<p>
<a href="../images/80-VB419-178_QuRT_User_Guide.pdf">Hexagon RTOS</a>
</p><hr>
<p>
<a href="../images/80-VB419-108_Hexagon_DSP_User_Guide.pdf">Hexagon DSP Programming</a>
</p><hr>
<h3>
<a name="Platforms"></a>Platforms
</h3><p>
<a href="../Platforms_HLOS.html">HLOS</a>
</p><p>
<a href="../Platforms_Simulator.html">Simulator</a>
</p><p>
<a href="../Platforms_Target.html">Target</a>
</p><hr>
<h3>
<a name="Environments"></a>Environments
</h3><p>
<a href="../Environments_Build%20System.html">Build System</a>
</p><p>
<a href="../Environments_Build%20System%20Porting.html">Build System Porting</a>
</p><p>
<a href="../Environments_Hexagon%20IDE.html">Hexagon IDE</a>
</p><hr>
<h3>
<a name="ArchitectureOverview"></a>ArchitectureOverview
</h3><p>
<a href="../HVX/ArchitectureOverview.html">HVX</a>
</p><hr>
<h3>
<a name="Applications"></a>Applications
</h3><p>
<a href="../Audio/Applications.html">Audio</a>
</p><p>
<a href="../Camera%20streaming/Applications.html">Camera streaming</a>
</p><p>
<a href="../Applications_Compute%20offload.html">Compute offload</a>
</p><p>
<a href="../FastCV/Applications_Computer%20Vision.html">Computer Vision</a>
</p><p>
<a href="../Neural%20Networks/Applications.html">Neural Networks</a>
</p><p>
<a href="../Voice/Applications.html">Voice</a>
</p><p>
<a href="../Camera%20streaming/Applications_legacy.html">legacy</a>
</p><hr>
<h3>
<a name="APIs"></a>APIs
</h3><p>
<a href="../APIs_Async%20Message%20Queue.html">Async Message Queue</a>
</p><p>
<a href="../APIs_DSP%20Clk%20&amp;%20Rsrc%20Mgmt.html">DSP Clk &amp; Rsrc Mgmt</a>
</p><p>
<a href="../APIs_Dynamic%20Loading.html">Dynamic Loading</a>
</p><p>
<a href="../APIs_FastRPC.html">FastRPC</a>
</p><hr>
<h3>
<a name="Examples"></a>Examples
</h3><p>
<a href="../Audio/Examples.html">Audio</a>
</p><p>
<a href="../Camera%20streaming/Examples.html">Camera streaming</a>
</p><p>
<a href="../Examples_Common.html">Common</a>
</p><p>
<a href="../Examples_ComputeHVX.html">ComputeHVX</a>
</p><p>
<a href="../Examples_GeneralOverview.html">GeneralOverview</a>
</p><p>
<a href="../Neural%20Networks/Examples.html">Neural Networks</a>
</p><p>
<a href="../Camera%20streaming/Examples_legacy.html">legacy</a>
</p><hr>
<h3>
<a name="Testing"></a>Testing
</h3><p>
<a href="../CAPIv2/Testing_CAPIv2%20Unit%20Tests.html">CAPIv2 Unit Tests</a>
</p><p>
<a href="../Testing_Eclipse%20Unit%20Tests.html">Eclipse Unit Tests</a>
</p><hr>
<h3>
<a name="Debugging"></a>Debugging
</h3><p>
<a href="../Debugging_Connect%20to%20Device.html">Connect to Device</a>
</p><p>
<a href="../Debugging_Exceptions.html">Exceptions</a>
</p><p>
<a href="../Debugging_Message%20Logging.html">Message Logging</a>
</p><p>
<a href="../Debugging_Simulator.html">Simulator</a>
</p><p>
<a href="../Debugging_Target.html">Target</a>
</p><hr>
<h3>
<a name="Tools"></a>Tools
</h3><p>
<a href="../Tools_Hexagon%20Tools%208.3.html">Hexagon Tools 8.3</a>
</p><p>
<a href="../Tools_IDL%20Compiler.html">IDL Compiler</a>
</p><p>
<a href="../Tools_On%20Target%20Profiling.html">On Target Profiling</a>
</p><p>
<a href="../Tools_Scripts.html">Scripts</a>
</p><p>
<a href="../Tools_Signing.html">Signing</a>
</p><p>
<a href="../Tools_UserGuides.html">UserGuides</a>
</p><p>
<a href="../Tools_Utilities.html">Utilities</a>
</p><hr>
<h3>
<a name="FAQ"></a>FAQ
</h3><p>
<a href="../FAQ_Common.html">Common</a>
</p><p>
<a href="../FAQ_Dynamic%20Loading.html">Dynamic Loading</a>
</p><p>
<a href="../FAQ_FastRPC.html">FastRPC</a>
</p><p>
<a href="../FAQ_Hexagon%20IDE.html">Hexagon IDE</a>
</p><hr>
<h3>
<a name="Dependencies"></a>Dependencies
</h3><p>
<a href="../Dependencies_Common.html">Common</a>
</p><hr>
<h3>
<a name="Release%20Notes"></a>Release Notes
</h3><p>
<a href="../Release%20Notes_Common.html">Common</a>
</p><hr>
<h3>
<a name="Support"></a>Support
</h3><p>
<a href="../Support_Contact.html">Contact</a>
</p><center><img src="../images/sidebar_bot.jpg"></center></div><div id="content"><a name="_top_" style="display:block;"></a><h1>
<a name="Audio%20unit%20testing"></a>Audio unit testing
</h1><div class="toc"><div class="tocLevel"><a href="#Overview">Overview</a></div><div class="tocLevel"><a href="#Architecture">Architecture</a><div class="tocLevel"><a href="#Support%20libraries">Support libraries</a></div></div><div class="tocLevel"><a href="#CAPIv2%20test%20framework">CAPIv2 test framework</a></div><div class="tocLevel"><a href="#APPI%20test%20framework">APPI test framework</a><div class="tocLevel"><div class="tocLevel"><a href="#test_appi">test_appi</a></div></div><div class="tocLevel"><a href="#Test%20configuration%20file">Test configuration file</a><div class="tocLevel"><a href="#ProcessData">ProcessData</a></div><div class="tocLevel"><a href="#SetMediaFormat">SetMediaFormat</a></div><div class="tocLevel"><a href="#SetMediaFormatWithMapping">SetMediaFormatWithMapping</a></div><div class="tocLevel"><a href="#SetParamInband">SetParamInband</a></div><div class="tocLevel"><a href="#GetParamInband">GetParamInband</a></div></div></div><div class="tocLevel"><a href="#CAPI%20test%20framework">CAPI test framework</a></div><div class="tocLevel"><a href="#Unit%20testing%20CAPI/APPI/CAPIv2%20modules">Unit testing CAPI/APPI/CAPIv2 modules</a><div class="tocLevel"><a href="#Eclipse%20based">Eclipse based</a></div><div class="tocLevel"><a href="#Command-line%20based%20unit%20testing">Command-line based unit testing</a></div></div><div class="tocLevel"><a href="#Measuring%20KPPS%20of%20algorithm%20in%20unit%20testing">Measuring KPPS of algorithm in unit testing</a></div></div><h2>
<a name="Overview"></a>Overview
</h2><p>
The Hexagon SDK provides a framework that enables unit testing of created modules. Unit testing can be done using
</p><ol type="1">
<li>
<p>
Eclipse projects Import existing Eclipse project into workspace, compile the project and easily run and debug unit test executable.
</p>
</li><li>
<p>
Quality tests(qtests). qtests are specified like any other target in a project's makefile. They are automatically run as part of the build process to complete the build/test development process. The tests themselves are compiled into Hexagon binaries and run via the Hexagon simulator. Currently qtests are only meant to be run on the Hexagon simulator, not on target.
</p>
</li>
</ol><h2>
<a name="Architecture"></a>Architecture
</h2><h3>
<a name="Support%20libraries"></a>Support libraries
</h3><p>
The SDK provides general unit test support libraries:
</p><ul type="circle">
<li>
<p>
<a href="../Platforms_Simulator.html#test_main">test_main</a>
</p>
</li><li>
<p>
<a href="../Platforms_Simulator.html#test_util">test_util</a>
</p>
</li>
</ul><p>
In addition, the SDK provides audio specific test support libraries.
</p><p>
CAPIv2 Interface
</p><ul type="circle">
<li>
<p>
test_capi_v2
</p>
</li><li>
<p>
capi_v2_utils_prop
</p>
</li><li>
<p>
capi_v2_test
</p>
</li>
</ul><p>
This library provides a test framework for verifying the functionality of objects that export APPI. For more information see <a href="#CAPIv2%20test%20framework">CAPIv2 test framework</a>
</p><p>
APPI Interface
</p><ul type="circle">
<li>
<p>
test_appi
</p>
</li><li>
<p>
appi_test
</p>
</li>
</ul><p>
This library provides a test framework for verifying the functionality of objects that export APPI. For more information see <a href="#APPI%20test%20framework">APPI test framework</a>
</p><h2>
<a name="CAPIv2%20test%20framework"></a>CAPIv2 test framework
</h2><p>
To know about CAPIv2 unit test framework functions and configuration file, please refer <a href="../CAPIv2/Testing_CAPIv2%20Unit%20Tests.html">CAPIv2 unit test framework</a>
</p><h2>
<a name="APPI%20test%20framework"></a>APPI test framework
</h2><p>
The support library test_appi contains an APPI specific test framework that allows for the verification of objects exporting the APPI interface. The framework is run by calling the framework's entry point from within a qtest's <a href="../Platforms_Simulator.html#Test%20sources">Test sources</a>. The signature of the entry point is as follows:
</p><pre>ADSPResult test_appi_main(getsize_f_t getsize_f, init_f_t init_f,
                          <span style="color: blue">const</span> <span style="color: blue">char</span> *filename_in, <span style="color: blue">const</span> <span style="color: blue">char</span> *filename_out,
                          <span style="color: blue">const</span> <span style="color: blue">char</span>* filename_config)

- getsize_f and init_f should contain function pointers to the pp module's
  getsize and init functions.  These can be obtained by calling dlsym() in
  the qtest's [[Test sources]].
- filename_in is the name of an audio file that should be processed by the
  test
- filename_out is the name of the output file generated by processing
  filename_in.
- filename_config is the [[Test configuration file]] that determines how the
  framework should verify the APPI module.
</pre><p>
The qtests for Hexagon SDK examples passthru and gain use the APPI Test Framework. For more detailed information about how to call it see those example's qtest source files.
</p><p>
Currently the APPI Test Framework does not support verification of the output audio file vs a known reference audio file. Future versions of the Hexagon SDK hope to add support for this feature. Until then the verification of the output file is left to the user.
</p><h4>
<a name="test_appi"></a>test_appi
</h4><p>
See the main <a href="../Platforms_Simulator.html#Enabling%20Simulator%20test">unit_test documentation</a>.
</p><h3>
<a name="Test%20configuration%20file"></a>Test configuration file
</h3><p>
Each test is configured using a configuration file. This file contains a list of commands to execute. The test framework reads and executes the commands from the config file sequentially. Note that the commands are case sensitive and should be entered exactly as they appear below.
</p><p>
The test framework supports the following commands and their parameters:
</p><ul type="circle">
<li>
<p>
<a href="#ProcessData">ProcessData</a>
</p><ul type="circle">
<li>
<p>
NumBuffers &lt;number&gt;
</p>
</li>
</ul>
</li><li>
<p>
<a href="#SetMediaFormat">SetMediaFormat</a>
</p><ul type="circle">
<li>
<p>
SetNumInChannels &lt;number&gt;
</p>
</li><li>
<p>
SetNumOutChannels &lt;number&gt;
</p>
</li><li>
<p>
SetInSamplingRate &lt;number&gt;
</p>
</li><li>
<p>
SetOutSamplingRate &lt;number&gt;
</p>
</li><li>
<p>
SetBytesPerSample &lt;number&gt;
</p>
</li>
</ul>
</li><li>
<p>
<a href="#SetMediaFormatWithMapping">SetMediaFormatWithMapping</a>
</p><ul type="circle">
<li>
<p>
SetNumInChannelsAndMapping &lt;number&gt;
</p>
</li><li>
<p>
SetNumOutChannels &lt;number&gt;
</p>
</li><li>
<p>
SetInSamplingRate &lt;number&gt;
</p>
</li><li>
<p>
SetOutSamplingRate &lt;number&gt;
</p>
</li><li>
<p>
SetBytesPerSample &lt;number&gt;
</p>
</li><li>
<p>
RefPayloadSizeInBytes &lt;number&gt;
</p>
</li>
</ul>
</li><li>
<p>
<a href="#SetParamInband">SetParamInband</a>
</p><ul type="circle">
<li>
<p>
PayloadSizeInBytes &lt;number&gt;
</p>
</li>
</ul>
</li><li>
<p>
<a href="#GetParamInband">GetParamInband</a>
</p><ul type="circle">
<li>
<p>
PayloadSizeInBytes &lt;number&gt;
</p>
</li><li>
<p>
&lt;payload&gt;
</p>
</li>
</ul>
</li>
</ul><h4>
<a name="ProcessData"></a>ProcessData
</h4><p>
Processes input buffers from the input file to the output file.
</p><p>
This command exercises the pp module's APPI methods get_input_required() and process().
</p><p>
e.g.
</p><pre>ProcessData
  NumBuffers 10
</pre><h4>
<a name="SetMediaFormat"></a>SetMediaFormat
</h4><p>
Sets the media parameters. This should be done to verify the correct handling of specific media parameters and also before a call to <a href="#ProcessData">ProcessData</a> to set up the medial parameters to be used during the processing. It sets the APPI library with the specified parameters by calling the pp module function reinit().
</p><p>
This command exercises the pp module's APPI method reinit().
</p><p>
e.g.
</p><pre>SetMediaFormat
  SetNumInChannels     2
  SetNumOutChannels    2
  SetInSamplingRate    48000
  SetOutSamplingRate   48000
  SetBytesPerSample    2
</pre><h4>
<a name="SetMediaFormatWithMapping"></a>SetMediaFormatWithMapping
</h4><p>
Sets the media parameters along with channel mapping. This should be done to verify the correct handling of specific media parameters and also before a call to <a href="#ProcessData">ProcessData</a> to setup the medial parameters to be used during the processing. It sets the APPI library with the specified parameters by calling the pp module function reinit().
</p><p>
This command exercises the pp module's APPI method reinit().
</p><p>
e.g.
</p><pre>SetMediaFormatWithMapping
  SetNumInChannelsAndMapping 3
    1 2 3
  SetNumOutChannels 3
  SetInSamplingRate 48000
  SetOutSamplingRate 48000
  SetBytesPerSample 2
</pre><h4>
<a name="SetParamInband"></a>SetParamInband
</h4><p>
Sets a parameter value. The information on the parameter and its payload are specified after the PayloadSizeInBytes parameter as illustrated in the example below.
</p><p>
This command exercises the pp module's APPI method set_param().
</p><p>
e.g.
</p><pre>SetParamInband
  PayloadSizeInBytes 24
  00 00 00 00    # Data Payload address
  10 00 00 00    # Size of Payload
  F1 FF FF FF    # MODULE_ID_GAIN_CTRL 0xFFFFFFF1
  11 10 00 10    # PARAM_ID_GAIN_CTRL_MASTER_GAIN 0x10001011
  04 00 00 00    # Param Size and Padding
  02 00 00 00    # Gain value and reserved
</pre><h4>
<a name="GetParamInband"></a>GetParamInband
</h4><p>
Gets a parameter value. The information on the parameter and its payload are specified after the PayloadSizeInBytes parameter as illustrated in the example below. Note that GetParamInband contains an additional parameter called RefPayloadSizeInBytes that specifies the expected binary value of the received parameter.
</p><p>
This command exercises the pp module's APPI method get_param().
</p><p>
e.g.
</p><pre>GetParamInband
   PayloadSizeInBytes 16
   00 00 00 00    # Data Payload address
   F1 FF FF FF    # MODULE_ID_GAIN_CTRL 0xFFFFFFF1
   08 07 01 00    # APPI_PARAM_ID_ALGORITHMIC_DELAY 0x00010708
   04 00 00 00    # Param Size and Padding
   RefPayloadSizeInBytes 4
   00 00 00 00
</pre><h2>
<a name="CAPI%20test%20framework"></a>CAPI test framework
</h2><p>
The unit test file contains a CAPI specific test framework that allows for the verification of objects exporting the CAPI interface. The framework is run by calling the framework's entry point from within a qtest's <a href="../Platforms_Simulator.html#Test%20sources">Test sources</a>. The signature of the entry point is as follows:
</p><pre><span style="color: blue">void</span> test_capi_main( capi_getsize_f getsize_f, capi_ctor_f ctor_f,
                      <span style="color: blue">void</span> *pFmtBlk, <span style="color: blue">const</span> <span style="color: blue">char</span>* filename_in,
                      <span style="color: blue">const</span> <span style="color: blue">char</span>* filename_out )

- getsize_f and ctor_f should contain function pointers to the CAPI module's
  getsize and ctor functions.  These can be obtained by calling dlsym() in
  the qtest's [[Test sources]].
- pFmtBlk corresponds to pointer to format block sent by APPS processor <span style="color: blue">while</span>
  executing media format update command
- filename_in is the name of an audio file that should be processed by the
  test
- filename_out is the name of the output file generated by processing
  filename_in.
</pre><p>
The qtests for SDK example pcm_decoder uses the CAPI Test Framework. For more detailed information about how to call it see capi_pcm_decoder.cpp file
</p><p>
Currently the CAPI Test Framework does not support verification of the output audio file vs a known reference audio file. Future versions of the SDK hope to add support for this feature. Until then the verification of the output file is left to the user. Also, in CAPI Test Framework media format block is set inside main. SDK users are expected to modify module_test.cpp file. Currently, Media format block pointer is sent to test_capi_main. In future versions of SDK, this is expected to move to a configuration file, hence avoiding manual addition of media format block.
</p><h2>
<a name="Unit%20testing%20CAPI/APPI/CAPIv2%20modules"></a>Unit testing CAPI/APPI/CAPIv2 modules
</h2><p>
NOTE : Present context covers unit testing of APPI FIR example. However, similar steps need to be followed for testing CAPIv2 and CAPI modules.
</p><h3>
<a name="Eclipse%20based"></a>Eclipse based
</h3><ol type="1">
<li>
<p>
Import the library project from specific example to be tested. Import the project as Common Library (.lib/.so). For more information on this please refer IDE Docs As an example, appi_fir is used. Similar steps should be followed for other examples.
</p><pre>File -&gt; Import -&gt; Hexagon C/C++
Project Type : Common Library (.lib/.so)
</pre><left><img alt="<Image not found&gt;" src="images/import_library_test.png"></left><p>
Ensure that project path, SDK root and Tools root are set appropriately.
</p>
</li><li>
<p>
Build the library project
</p><pre>Right click on project -&gt; Build Configuration -&gt; Build all
</pre><p>
This project builds Dynamic and Static libraries in debug and release mode. Verify all libraries to be built.
</p>
</li><li>
<p>
Import the test project from specific example to be tested. Import the project as Executable (.exe). For more information on this please refer IDE Docs As an example, appi_fir is used. Similar steps should be followed for other examples.
</p><pre>File -&gt; Import -&gt; Hexagon C/C++
Project Type : Executable (.exe)
</pre><left><img alt="<Image not found&gt;" src="images/import_unit_test.jpg"></left><p>
Ensure that project path, SDK root and Tools root are set appropriately.
</p>
</li><li>
<p>
Build the test project
</p><pre>Right click on project -&gt; Build Configuration -&gt; Build all
</pre><p>
This project builds test Executable in debug and release mode.
</p><p>
By default, Eclipse project builds Static module. To test dynamic library add __V_DYNAMIC__ flag to Eclipse test projects.
</p>
</li><li>
<p>
To run/debug unit test exe.
</p><ol type="a">
<li>
<p>
Create a new run configuration for unit test executable.
</p><pre style="font-size: 85%">Right click on project -&gt; Run As -&gt; Run Configurations -&gt; Hexagon C/C++ Application
</pre><left><img alt="<Image not found&gt;" src="images/run_config.jpg"></left>
</li><li>
<p>
Input Arguments to binary
</p><ol type="1">
<li>
<p>
Add input arguments to the executable.
</p><p>
For APPI, input, output and config files have to be specified. ex. appi_fir
</p><pre>-i  ../../data/wnoise_48k_stereo.raw -o ../../data/output_wnoise_48k_stereo.raw
-c ../../data/hpf.cfg
</pre><left><img alt="<Image not found&gt;" src="images/input_args.jpg"></left><p>
For CAPI, input and output files have to be added. ex. capi_pcm_decoder
</p><pre>-i ../../data/input.raw -o ../../data/output.raw
</pre><p>
For CAPIv2, input and output files have to be added. ex. capi_v2_decimate
</p><pre>-i ../../data/input.raw -o ../../data/output.raw 
-c ../../data/decimation_factor_set.cfg
</pre>
</li><li>
<p>
Instead of adding input arguments manually, use qhut file
</p><pre>Right click on project test_appi_fir -&gt; New -&gt; File
Create a new file named : test_list.qhut
Create new test cases using qhut file
</pre><left><img alt="<Image not found&gt;" src="images/qhut.jpg"></left><p>
NOTE : This should not be used for capi example as no configuration file supported.
</p>
</li>
</ol>
</li><li>
<p>
If dynamic library is being tested then specify it's relative path using &#8220;usefs&#8221; flag. Add the following simulator flag in Miscellaneous box on Simulator tab. Example below shows the method to test appi_fir.so Shared debug library.
</p><pre>--usefs ../appi_fir/Shared-Debug
</pre><left><img alt="<Image not found&gt;" src="images/usefs.jpg"></left><p>
Similarly, other simulation parameters can be passed on to simulator from this UI. All simulation parameters can be found on Hexagon Programmers Reference manual. Explore these parameters to have close results to target on simulator.
</p>
</li>
</ol>
</li>
</ol><p>
NOTE : All the Test Executables projects are provided with a .launch and .qhut file. Launch file(.launch) file provides required configuration to Run/Debug the project. Step 5 can be avoided by clicking on &#8220;Run&#8221; or &#8220;Debug&#8221; icon by selecting the project. This will Run/Debug with the configuration provided in launch file
</p><h3>
<a name="Command-line%20based%20unit%20testing"></a>Command-line based unit testing
</h3><p>
In command-line based unit test framework, the library is built first and then unit tested using a single command.
</p><p>
As a reference example, appi_fir is used. Please execute similar commands to test other APPI/CAPI/CAPIv2 examples.
</p><ul>
<li>
<p>
Instructions to test Dynamic Library :
</p><ol type="1">
<li>
<p>
Open a CLI shell and navigate to &lt;HEXAGON_SDK_ROOT&gt;\examples\audio\appi_fir
</p><pre>cd &lt;HEXAGON_SDK_ROOT&gt;\examples\audio\appi_fir
</pre>
</li><li>
<p>
Execute the following command to test Dynamic Library.
</p><p>
Target = hexagon ; Toolset version = v81 ; Arch Version = V65 ; Flavor = Debug ; Options = dynamic
</p><pre>make V=hexagon_Debug_dynamic_toolv81_v65 tree VERBOSE=1
</pre>
</li><li>
<p>
Verify the test to be passed
</p>
</li>
</ol>
</li><li>
<p>
Instructions to test Static Library :
</p><ol type="1">
<li>
<p>
Open a CLI shell and navigate to &lt;HEXAGON_SDK_ROOT&gt;\examples\audio\appi_fir
</p><pre>cd &lt;HEXAGON_SDK_ROOT&gt;\examples\audio\appi_fir
</pre>
</li><li>
<p>
Execute the following command to test Static Library
</p><p>
Target = hexagon ; Version = V5 ; Flavor = Debug ;
</p><pre>make V=hexagon_Debug tree VERBOSE=1
</pre>
</li><li>
<p>
Verify the test to be passed
</p>
</li>
</ol>
</li>
</ul><p>
For more information on building using make.d, please refer <a href="../Environments_Build%20System.html">make.d</a> documentation.
</p><p>
NOTE : In command-line based unit testing, input arguments to executable are hard coded in the unit test source file.
</p><p>
Also, for loading a dynamic library, &#8212;usefs flag is added to build system.
</p><h2>
<a name="Measuring%20KPPS%20of%20algorithm%20in%20unit%20testing"></a>Measuring KPPS of algorithm in unit testing
</h2><p>
To measure KPPS requirement, measure the number of cycles consumed by APPI process() function for one block of data. If there is no block size in the algorithm, assume it to be around 50-100 samples to eliminate the effect of the fixed overheads in the function.
</p><p>
KPPS = process_cycles / BLOCK_SIZE * sampling_rate
</p><p align="center" style="display:block;padding-top: 50px;">
  Copyright &#169; 2018 Qualcomm Technologies Inc. All rights reserved.

</p><a style="display:block;padding-bottom: 700px;"></a></div></div>
</body>
</html>
