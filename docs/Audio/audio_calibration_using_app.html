<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta content="text/html;charset=utf-8" http-equiv="Content-Type">
<style type="text/css">
table {
   border-collapse: collapse;
   border-width: 1px;
   border-spacing: 1px;
   border-color: transparent;
   margin: 16px 0;
   width: 100%;
}
th {
   background-color: #bbb; color: white;
}
td, th {
   border-style: solid;
   border-color: black;
   border-width: 1px;
   padding: 0 6px;
}
td p:first-child, th p:first-child {
   margin-top: 3px;
}
td p:last-child, th p:last-child {
   margin-bottom: 3px;
}

.smarkdoc {
  margin-left: 42px; margin-right: 42px;
  font-size: 13px;
  font-family: 'Lucida Grande', Geneva, Helvetica, Arial, sans-serif;
}

h1, h2, h3 { color: #3c4c6c; }
h1 {
  text-align: center;
  font-size: 200%;
/*    margin-left: -30px; */
  clear: both;
}
h2 {
  font-size: 160%;
  margin: 32px -40px 24px -42px;
  padding: 3px 24px 8px;
  border-bottom: 2px solid #5088c5;
  clear: both;
}
h3 {
  font-size: 130%;
  margin: 20px -4px 10px;
  padding: 4px;
  clear: both;
}
h4 {
  font-size: 110%;
  margin: 2em 0 1em;
}

pre {
  font-size: 90%;
  background-color: #f0f0f4; padding: 6px; border: 1px solid #d0d0ee;
  font-family: "Courier New", "Lucida Console", "Monaco", monospace;
}

.pre {
  font-size: 90%;
  padding: 6px;
  background-color: #f0f0f4;
  font-family: "Courier New", "Lucida Console", "Monaco", monospace;
}

code {
  font-size: 90%;
  font-family: "Courier New", "Lucida Console", "Monaco", monospace;
}

h3 code {
  font-size: 100%;
}

p {
  margin: 0.8em 0;
}
ul, ol {
  margin: 1em 0 1em 3em; padding: 0;
}
div.indent {
  margin: 0 3em;
}

a[href] {
  text-decoration: none;
  color: #2020b0;
}
a[href]:hover {
  border-bottom: 1px dotted #2030d0;
}

/* Smark Users Guide */

.codebox {
  padding: 0 1px;  margin-right:1px;
  border:1px solid #d0d0ee;
  background-color: #f0f0f4;
  font-weight: bold;
  font-family: "Courier New", "Lucida Console", "Monaco", monospace;
}

/* ================ Smark-specific classes ================ */

.indent {
  margin: 0 3em;
}

/*
|| Floats affect text flow but not block boundaries, so graphics in a DIV
|| would overlap floats if not for "clear: both"
*/
.diagram {
  margin: 18px 0;
  clear: both;
}

/* ASCII Art */

.art {
  margin-right: auto; margin-left: auto; /* center */
  font-family: Arial, Verdana, "Lucida Console", Monaco, monospace;
  font-weight: bold;
}
.art * {
   border-color: #543;
}
.art .dline, .art .drect {
   border-style: dotted;
}
.art .rect {
   -webkit-box-shadow: 0.2em 0.2em 0.3em rgba(0,0,0,0.3);
   -moz-box-shadow: 0.2em 0.2em 0.3em rgba(0,0,0,0.3);
   box-shadow: 0.2em 0.2em 0.2em #875;
   background-color: #f9faf4; /* #fafff4; #f8f8ec;  */
}
.art .nofx {
   background-color: #f9faf4;
}
.art .round {
   border-radius: 0.6em;
   -webkit-border-radius: 0.6em;
   -moz-border-radius: 0.6em;
}

/* .art .line {  -webkit-box-shadow: 0.1em 0.1em 0.2em rgba(0,0,0,0.3); } */

/* Sequence Charts */

.msc {
   font: 11px Verdana, Monaco, "Lucida Console";
   margin-left: auto; margin-right: auto;
   background-color: white;
   /* border: 1px solid #555; */  /* Useful for non-white pages */
}

/* Table of Contents */

.tocLevel {
  margin-left: 2em;
  font-weight: normal;
}
.tocLevel .tocLevel {
  font-size: 90%; /* ...of inherited font size */
  line-height: 150%; /* ...of font size */
}
.toc > .tocLevel {
  font-weight: bold;
  margin: 0.5em 0
}
.toc {
  column-count: 2; column-gap: 2em;
  -moz-column-count: 2; -moz-column-gap: 2em;
  -webkit-column-count: 2; -webkit-column-gap: 2em;
}

/* ordinary text content is in P elements */

td p:first-child, th p:first-child {
   margin-top: 3px;
}
td p:last-child, th p:last-child {
   margin-bottom: 3px;
}
li p:only-child {
  margin-top: 0;
  margin-bottom: 0;
}

/* ================ Print ================ */

@media print {

  @page {
    margin: 0.75in 0.75in;
    size: Letter;
    @bottom {
      content: counter(page);
      vertical-align: top;
      padding-top: 1em;
    }
  }
  h1 { text-align: center;
       margin: 3in 0 20px; }
  h2 { page-break-before: always; }
  h2 { string-set: section content() }
  .toc { margin: 3em -2em }
  .toc a::after {
     font-size: 10px;
     content: leader(' . ') "  " target-counter(attr(href), page);
  }
  table { page-break-inside: avoid; }
}

/* ================  Layout  ================ */
/*
 *  +------------------------+
 *  |         #header        |
 *  +----------+-------------+
 *  | #sidebar |  #content   |
 *  |          |             |
 *  +----------+-------------+
 *
 * CSS padding, border width, and border style (!) affect the actual height
 * (and in turn layout).
 */

#header {
  position: fixed;
  top: 0px;
  height: 32px;
  left: 0px;
  width: 100%;
  padding: 10px 10px 0 0;
}
#sidebar {
  position: fixed;
  top: 42px;
  bottom: 0px;
  left: 0px;
  min-width: 180px;
  overflow: auto;
  border: 1px solid transparent;
  border-width: 0 1px 0 1px;
  padding: 0px 5px 0px 5px;
}
#content {
  position: fixed;
  top: 60px;
  left: 200px;
  bottom: 0px;
  right: 0px;
  overflow: auto;
  -webkit-overflow-scrolling: touch;
  padding: 10px 20px;
  padding-top: 0;
}

/* ================  Styles  ================ */


body {
  font-family: "Lucida Grande", Helvetica, Arial, sans-serif;
  font-size: 16px;
}

#header {
  color: #fff;
  background: #555;
  text-align: center;
  font-size: 25px;
}

#sidebar {
  color: #000;
  background: #eee;
  border-right: 1px solid #bbb;
  text-align: left;
  font-size: 12px;
  line-height: 50%;
}

#sidebar h1 {
  margin: 0 0 0 0;
  border-left: 5px solid transparent;
  text-align: left;
  font-size: 12px;
  /*text-shadow: #fff 1px 0px;*/
  line-height: 1%;
}

#sidebar h2 {
  margin: 2px 0 8px 0;
  border-left: 5px solid transparent;
  text-align: center;
  font-size: 12px;
  /*text-shadow: #fff 1px 0px;*/
  line-height: 1%;
}



#content {
  margin: 0;
  font-size: 13px;
  line-height: 160%;
}

#content h1, #content h2 {
  border-bottom: 2px solid;
  font-size: 1.8em;
  font-weight: normal;
  margin: 2.0em 0px 1.3em 0px;
  padding-bottom: 0.6em;
  text-align: left;
}

#content h3 {
  color: #242220;
  font-size: 1.4em;
  font-weight: normal;
  margin: 2em 0px 0.8em 0px;
  text-shadow: #FFFFFF 0px 1px 1px;
}
#content h4 {
  font-size: 1.2em;
  font-weight: normal;
  margin: 2em 0px 0.5em 0px;
  text-shadow: #FFFFFF 0px 1px 1px;
}

a[href] {
  color: #05c;
  text-decoration: none;
}

#sidebar a {
  /*text-shadow:  1px 1px 2px #fff, -1px -1px #ddd;*/
  line-height: 40%;
}

pre, code {
  font-family: "Courier New", "Lucida Console", "Monaco", monospace;
  font-family: "Monaco", monospace;  font-size: 90%;
  background-color: #f8f8fa;
  border: 1px solid #e4e4ee;
  -webkit-border-radius: 2px;
  -moz-border-radius: 2px;
  border-radius: 2px;
  padding: 1px 0 0 1px;
}

pre {
  padding: 2px 4px;
}

table {
   border-collapse: collapse;
   border-width: 1px;
   border-spacing: 1px;
   border-color: transparent;
   margin: 16px 0;
   width: 100%;
}
th {
   background-color: #bbb; color: white;
}
td, th {
   border-style: solid;
   border-color: black;
   border-width: 1px;
   padding: 0 6px;
}

/* Highlight currently-selected sidebar link */

#sidebar a.thisfile {
  color: #557;
}

/* indentation */

#content {
   padding-left: 60px;
}
#content h1, 
#content h2, 
#content h3, h4 {
    margin-left: -30px;
}

h3 > code {
    font-size: 80%;
}

/* ================ Smark-specific classes ================ */

.indent {
  margin: 0 3em;
}

/*
|| Floats affect text flow but not block boundaries, so graphics in a DIV 
|| would overlap floats if not for "clear: both"
*/
.diagram {
  margin: 18px 0;
  clear: both;
}

/* ASCII Art */

.art {
  margin-right: auto; margin-left: auto; /* center */
  font-family: Arial, Verdana, "Lucida Console", Monaco, monospace;
  font-weight: bold;
}
.art * {
   border-color: #543;
}
.art .dline, .art .drect {
   border-style: dotted;
}
.art .rect {
   -webkit-box-shadow: 0.2em 0.2em 0.3em rgba(0,0,0,0.3);
   -moz-box-shadow: 0.2em 0.2em 0.3em rgba(0,0,0,0.3);
   box-shadow: 0.2em 0.2em 0.2em #875;
   background-color: #f9faf4; /* #fafff4; #f8f8ec;  */
}
.art .nofx {
   background-color: #f9faf4;
}
.art .round {
   border-radius: 0.6em;
   -webkit-border-radius: 0.6em;
   -moz-border-radius: 0.6em;
}

/* Sequence Charts */

.msc {
   font: 11px Verdana, Monaco, "Lucida Console"; 
   margin-left: auto; margin-right: auto;
   background-color: white;
   border: 1px solid #555;
}

/* Table of Contents */

.tocLevel {
  margin-left: 2em;
  font-weight: normal;
}
.tocLevel .tocLevel {
  font-size: 90%; /* ...of inherited font size */
  line-height: 150%; /* ...of font size */
}
/*
.toc > .tocLevel {
  font-weight: bold;
  margin: 0.5em 0
}
*/

.toc {
  column-count: 1; column-gap: 2em;
  -moz-column-count: 1; -moz-column-gap: 2em;
  -webkit-column-count: 1; -webkit-column-gap: 2em; 
   alternate: column-width: 235px; column-rule-width: 5px;
}


.columns {
  column-count: 2; column-gap: 2em;
  -moz-column-count: 2; -moz-column-gap: 2em;
  -webkit-column-count: 2; -webkit-column-gap: 2em; p
}

/* ordinary text content is in P elements */

td p:first-child, th p:first-child {
   margin-top: 3px;
}
td p:last-child, th p:last-child {
   margin-bottom: 3px;
}
li p:only-child {
  margin-top: 0;
  margin-bottom: 0;
}


/* ================ Print ================ */

@media print {

  #header, #content { position: static; }
  #sidebar { display: none; }

  @page {
    margin: 0.75in 0.75in;
    size: Letter;
    @bottom {
      content: counter(page);
      vertical-align: top;
      padding-top: 1em;
    }
  }
  h1 { text-align: center;
       margin: 1in 0 1in; }
  h2 { page-break-before: always; }
  h2 { string-set: section content() }
  .toc { margin: 3em 0 }
  .toc a::after {
     font-size: 10px;
     content: leader(' . ') "  " target-counter(attr(href), page);
  }
  table { page-break-inside: avoid; }
}


</style><style type="text/css">
.search { right: 20pt; position: fixed; top: 5pt }

</style><title>Run Time Audio Calibration</title>
</head><body>
<div class="smarkdoc"><div id="header">Hexagon SDK 3.5.4</div><div id="sidebar"><top><img src="../images/sidebar_top.jpg"></top><script src="../scripts/post.js" type="text/javascript"></script><form class="search" id="searchForm"><input id="searchquery" name="q" onkeydown="postFunctionKeydown(event, true)"><input id="searchButton" onclick="postFunction(true)" type="button" value="Search"></form><p>
<a href="../index.html">Quick start</a>
</p><hr>
<p>
<a href="../feature_matrix.html">Feature Matrix</a>
</p><hr>
<p>
<a href="../hexagon_architecture.html">Hexagon Architecture</a>
</p><hr>
<p>
<a href="../images/Hexagon_Document_Bundle.pdf#page=2881">Hexagon Compiler/Linker</a>
</p><hr>
<p>
<a href="../hexagon_libraries.html">Hexagon Standard Libraries</a>
</p><hr>
<p>
<a href="../images/80-VB419-178_QuRT_User_Guide.pdf">Hexagon RTOS</a>
</p><hr>
<p>
<a href="../images/80-VB419-108_Hexagon_DSP_User_Guide.pdf">Hexagon DSP Programming</a>
</p><hr>
<h3>
<a name="Platforms"></a>Platforms
</h3><p>
<a href="../Platforms_HLOS.html">HLOS</a>
</p><p>
<a href="../Platforms_Simulator.html">Simulator</a>
</p><p>
<a href="../Platforms_Target.html">Target</a>
</p><hr>
<h3>
<a name="Environments"></a>Environments
</h3><p>
<a href="../Environments_Build%20System.html">Build System</a>
</p><p>
<a href="../Environments_Build%20System%20Porting.html">Build System Porting</a>
</p><p>
<a href="../Environments_Hexagon%20IDE.html">Hexagon IDE</a>
</p><hr>
<h3>
<a name="ArchitectureOverview"></a>ArchitectureOverview
</h3><p>
<a href="../HVX/ArchitectureOverview.html">HVX</a>
</p><hr>
<h3>
<a name="Applications"></a>Applications
</h3><p>
<a href="../Audio/Applications.html">Audio</a>
</p><p>
<a href="../Camera%20streaming/Applications.html">Camera streaming</a>
</p><p>
<a href="../Applications_Compute%20offload.html">Compute offload</a>
</p><p>
<a href="../FastCV/Applications_Computer%20Vision.html">Computer Vision</a>
</p><p>
<a href="../Neural%20Networks/Applications.html">Neural Networks</a>
</p><p>
<a href="../Voice/Applications.html">Voice</a>
</p><p>
<a href="../Camera%20streaming/Applications_legacy.html">legacy</a>
</p><hr>
<h3>
<a name="APIs"></a>APIs
</h3><p>
<a href="../APIs_Async%20Message%20Queue.html">Async Message Queue</a>
</p><p>
<a href="../APIs_DSP%20Clk%20&amp;%20Rsrc%20Mgmt.html">DSP Clk &amp; Rsrc Mgmt</a>
</p><p>
<a href="../APIs_Dynamic%20Loading.html">Dynamic Loading</a>
</p><p>
<a href="../APIs_FastRPC.html">FastRPC</a>
</p><hr>
<h3>
<a name="Examples"></a>Examples
</h3><p>
<a href="../Audio/Examples.html">Audio</a>
</p><p>
<a href="../Camera%20streaming/Examples.html">Camera streaming</a>
</p><p>
<a href="../Examples_Common.html">Common</a>
</p><p>
<a href="../Examples_ComputeHVX.html">ComputeHVX</a>
</p><p>
<a href="../Examples_GeneralOverview.html">GeneralOverview</a>
</p><p>
<a href="../Neural%20Networks/Examples.html">Neural Networks</a>
</p><p>
<a href="../Camera%20streaming/Examples_legacy.html">legacy</a>
</p><hr>
<h3>
<a name="Testing"></a>Testing
</h3><p>
<a href="../CAPIv2/Testing_CAPIv2%20Unit%20Tests.html">CAPIv2 Unit Tests</a>
</p><p>
<a href="../Testing_Eclipse%20Unit%20Tests.html">Eclipse Unit Tests</a>
</p><hr>
<h3>
<a name="Debugging"></a>Debugging
</h3><p>
<a href="../Debugging_Connect%20to%20Device.html">Connect to Device</a>
</p><p>
<a href="../Debugging_Exceptions.html">Exceptions</a>
</p><p>
<a href="../Debugging_Message%20Logging.html">Message Logging</a>
</p><p>
<a href="../Debugging_Simulator.html">Simulator</a>
</p><p>
<a href="../Debugging_Target.html">Target</a>
</p><hr>
<h3>
<a name="Tools"></a>Tools
</h3><p>
<a href="../Tools_Hexagon%20Tools%208.3.html">Hexagon Tools 8.3</a>
</p><p>
<a href="../Tools_IDL%20Compiler.html">IDL Compiler</a>
</p><p>
<a href="../Tools_On%20Target%20Profiling.html">On Target Profiling</a>
</p><p>
<a href="../Tools_Scripts.html">Scripts</a>
</p><p>
<a href="../Tools_Signing.html">Signing</a>
</p><p>
<a href="../Tools_UserGuides.html">UserGuides</a>
</p><p>
<a href="../Tools_Utilities.html">Utilities</a>
</p><hr>
<h3>
<a name="FAQ"></a>FAQ
</h3><p>
<a href="../FAQ_Common.html">Common</a>
</p><p>
<a href="../FAQ_Dynamic%20Loading.html">Dynamic Loading</a>
</p><p>
<a href="../FAQ_FastRPC.html">FastRPC</a>
</p><p>
<a href="../FAQ_Hexagon%20IDE.html">Hexagon IDE</a>
</p><hr>
<h3>
<a name="Dependencies"></a>Dependencies
</h3><p>
<a href="../Dependencies_Common.html">Common</a>
</p><hr>
<h3>
<a name="Release%20Notes"></a>Release Notes
</h3><p>
<a href="../Release%20Notes_Common.html">Common</a>
</p><hr>
<h3>
<a name="Support"></a>Support
</h3><p>
<a href="../Support_Contact.html">Contact</a>
</p><center><img src="../images/sidebar_bot.jpg"></center></div><div id="content"><a name="_top_" style="display:block;"></a><h1>
<a name="Run%20Time%20Audio%20Calibration"></a>Run Time Audio Calibration
</h1><div class="toc"><div class="tocLevel"><a href="#Goal">Goal</a></div><div class="tocLevel"><a href="#Overview">Overview</a></div><div class="tocLevel"><a href="#setParameters()">setParameters()</a></div><div class="tocLevel"><a href="#getParameters()">getParameters()</a></div><div class="tocLevel"><a href="#Common%20Keys">Common Keys</a><div class="tocLevel"><a href="#cal_persist">cal_persist</a></div><div class="tocLevel"><a href="#cal_devid">cal_devid</a></div><div class="tocLevel"><a href="#cal_apptype">cal_apptype</a></div><div class="tocLevel"><a href="#cal_caltype">cal_caltype</a></div><div class="tocLevel"><a href="#cal_samplerate">cal_samplerate</a></div><div class="tocLevel"><a href="#cal_topoid">cal_topoid</a></div><div class="tocLevel"><a href="#cal_moduleid">cal_moduleid</a></div><div class="tocLevel"><a href="#cal_paramid">cal_paramid</a></div></div><div class="tocLevel"><a href="#Examples%20-%20Set/Get">Examples - Set/Get</a><div class="tocLevel"><a href="#Utility%20functions">Utility functions</a></div><div class="tocLevel"><a href="#Set%20data%20of%20one%20parameter">Set data of one parameter</a></div><div class="tocLevel"><a href="#Set%20data%20of%20multiple%20parameters">Set data of multiple parameters</a></div><div class="tocLevel"><a href="#Get%20a%20parameter">Get a parameter</a></div></div><div class="tocLevel"><a href="#Test%20Application">Test Application</a></div><div class="tocLevel"><a href="#Quick%20FAQ">Quick FAQ</a></div></div><h2>
<a name="Goal"></a>Goal
</h2><p>
Enabling run time access to audio tuning parameters of modules running in COPP/POPP path from an Android Java user applications.
</p><h2>
<a name="Overview"></a>Overview
</h2><p>
Tuning of audio processing path is done by a PC application, QACT/QACT_Lite. It allows offline and online calibration of audio/voice path. Device must be connected to PC for accessing parameters of audio modules running on ADSP.
</p><p>
The interface described in this section allows to set and get parameters of audio modules directly from Android applications running in java layer. It means run time control of audio path from Android java applications. It is explained in the below figure.
</p><left><img alt="<Image not found&gt;" src="images/audio_cal.png"></left><p>
Android AudioManager, <a href="http://developer.android.com/reference/android/media/AudioManager.html">android.media.AudioManager</a> defines &#8220;setParameters&#8221; and &#8220;getParameters&#8221; methods to access audio hardware parameters. These methods are extended for run time audio calibration with new key value pairs.
</p><ol class="indent" type="1">
<li>
<p>
setParameters(cal_keys=values,...) - set tuning parameters
</p>
</li><li>
<p>
getParameters(cal_keys=values,...) - get tuning parameters
</p>
</li>
</ol><p>
Persist option allows to store the parameters in Audio Calibration Database (ACDB) and valid across reboot of the device. Parameters set with persist option only replaces the parameters in ACDB. But it doesn't allow to add new parameters with unique IDs. QACT Lite must be used to add and remove parameters of a module from ACDB and then this interface can be used to overwrite them at run time.
</p><p>
NOTE: Run time calibration from java applications is supported only for audio. Voice path is not supported.
</p><p>
NOTE: This interface is available only for chipsets MSM8x94 or later with Android-L.
</p><h2>
<a name="setParameters()"></a>setParameters()
</h2><p>
Set parameters of audio modules.
</p><p>
setParameters() method is defined in <a href="http://developer.android.com/reference/android/media/AudioManager.html">android.media.AudioManager</a> class. It is extended with new keys for supporting run time audio calibration.
</p><pre>setParameters(key1=value1;key2=value2;...);
</pre><p>
Keys required for setting parameters are <a href="audio_calibration_using_app.html#cal_persist">cal_persist</a>, <a href="audio_calibration_using_app.html#cal_devid">cal_devid</a>, <a href="audio_calibration_using_app.html#cal_apptype">cal_apptype</a>, <a href="audio_calibration_using_app.html#cal_caltype">cal_caltype</a>, <a href="audio_calibration_using_app.html#cal_samplerate">cal_samplerate</a>, <a href="audio_calibration_using_app.html#cal_topoid">cal_topoid</a>, <a href="audio_calibration_using_app.html#cal_moduleid">cal_moduleid</a>, <a href="audio_calibration_using_app.html#cal_paramid">cal_paramid</a> and cal_data.
</p><p>
'cal_data' key holds the actual parameters encoded using <a href="http://developer.android.com/reference/android/util/Base64.html">base64</a> string format.
</p><p>
Setting data of one parameter using module and parameter keys :-
</p><div class="indent"><p>
'cal_data' key holds the parameters encoded as a string. <a href="audio_calibration_using_app.html#cal_moduleid">cal_moduleid</a> and <a href="audio_calibration_using_app.html#cal_paramid">cal_paramid</a> specifies module and parameter IDs respectively. Refer <a href="audio_calibration_using_app.html#Set%20data%20of%20one%20parameter">set param example</a> for more information.
</p></div><p>
Setting data of multiple parameters of modules :-
</p><div class="indent"><p>
'cal_data' key holds module and parameter IDs also along with parameters data in a format shown below.
</p><pre><span style="color: darkgreen">//RESERVED and LENGTH fields are 16 bit and other 32 bit</span>
MODULEID#1
PARAMID#1
RESERVED | LENGTH
DATA_FOR#1
MODULEID#1
PARAMID#2
RESERVED | LENGTH
DATA_FOR#2
...
MODULEID#n
PARAMID#m
RESERVED | LENGTH
DATA_FOR#m
</pre><p>
Refer <a href="audio_calibration_using_app.html#Set%20data%20of%20multiple%20parameters">set param example</a> for more information.
</p></div><p>
NOTE: SetParameters interface to ADSP always expects the data in multiple of 4 bytes for a single parameter. Hence ensure length of parameters are multiple of 4.
</p><h2>
<a name="getParameters()"></a>getParameters()
</h2><p>
Get parameters of a module. It supports to get parameters associated with a single parameter ID of a module.
</p><p>
getParameters() method is defined in <a href="http://developer.android.com/reference/android/media/AudioManager.html">android.media.AudioManager</a> class. It is extended with new keys for supporting run time audio calibration.
</p><pre>String data = getParameters(key1=value1;key2=value2;...);
</pre><p>
Keys required to get parameters are <a href="audio_calibration_using_app.html#cal_persist">cal_persist</a>, <a href="audio_calibration_using_app.html#cal_devid">cal_devid</a>, <a href="audio_calibration_using_app.html#cal_apptype">cal_apptype</a>, <a href="audio_calibration_using_app.html#cal_caltype">cal_caltype</a>, <a href="audio_calibration_using_app.html#cal_samplerate">cal_samplerate</a>, <a href="audio_calibration_using_app.html#cal_topoid">cal_topoid</a>, <a href="audio_calibration_using_app.html#cal_moduleid">cal_moduleid</a>, <a href="audio_calibration_using_app.html#cal_paramid">cal_paramid</a> and cal_data.
</p><p>
'cal_data' key is mandatory and set it to 0. Default value 0 is assumed for all other keys if not set.
</p><p>
getParameters method returns a string with two keys 'cal_result' and 'cal_data'.
</p><pre>cal_result=&lt;error number&gt;;cal_data=&lt;base64 encoded string&gt;
</pre><p>
cal_result: 0 for Success and other values for Failure. cal_data is valid only if the result is success.
</p><p>
cal_data(returned key):
</p><p>
Parameters are encoded in base64 format. Decode using Base64.decode() method to get the integer parameters. Data returned here is valid only when cal_result returned with 0.
</p><p>
Refer <a href="audio_calibration_using_app.html#Get%20a%20parameter">get param example</a> for more information.
</p><h2>
<a name="Common%20Keys"></a>Common Keys
</h2><p>
Key Value pairs defined here are valid for set/get parameters methods.
</p><pre>key=&lt;value&gt;;
</pre><p>
Default values for these keys are 0. Based on these keys, set/getParameters identify a module in given topology associated with a selected device or session.
</p><h3>
<a name="cal_persist"></a>cal_persist
</h3><p>
Flag to configure parameters as persistent or non-persistent. Persistent parameters are stored in ACDB and they are valid across reboots. Non-persistent parameters are valid for the selected active sessions.
</p><p>
0 : non-persistent. Runtime set/get to/from modules running in ADSP for all valid active sessions.
</p><div class="indent"><p>
These parameters are not valid for new sessions created after the set/get. Used for real time calibration.
</p></div><p>
1 : Persistent. It store parameters in ACDB and persistent across reboots.
</p><div class="indent"><p>
New parameters are not valid for current active sessions. They are effective only for new sessions created after set/get.
</p></div><p>
All non-zero values are treated as persistent.
</p><h3>
<a name="cal_devid"></a>cal_devid
</h3><p>
Audio output devices defined as audio_device_t enum in system/audio.h. Audio device id is converted to devices in QACT, where topologies, apptypes and other properties are associated.
</p><h3>
<a name="cal_apptype"></a>cal_apptype
</h3><p>
Application type to which the calibration needs to be applied. It is defined in QACT. Refer QACT to find the list of application types.
</p><p>
For example,
</p><p>
Audio Playback : 0x00011130
</p><p>
Audio Recording: 0x00011132
</p><h3>
<a name="cal_caltype"></a>cal_caltype
</h3><p>
Calibration type for audio COPP/POPP topologies. Currently supported only for audio.
</p><p>
0 : AUDIO_COPP
</p><p>
1 : AUDIO_POPP
</p><p>
All other values are invalid.
</p><h3>
<a name="cal_samplerate"></a>cal_samplerate
</h3><p>
Sample rate of the device selected using cal_devid.
</p><h3>
<a name="cal_topoid"></a>cal_topoid
</h3><p>
Topology ID associated to the selected device, for which the calibration required.
</p><h3>
<a name="cal_moduleid"></a>cal_moduleid
</h3><p>
Module ID associated to the selected topology, for which the calibration required.
</p><h3>
<a name="cal_paramid"></a>cal_paramid
</h3><p>
Parameter ID associated to the selected module, for which the calibration required.
</p><p>
Only topology/module/param IDs defined in the QACT are accessible for set/get.
</p><p>
This interface is used only to tune the defined parameters in QACT earlier.
</p><h2>
<a name="Examples%20-%20Set/Get"></a>Examples - Set/Get
</h2><h3>
<a name="Utility%20functions"></a>Utility functions
</h3><p>
Few utility functions given here which are common for both Set and Get.
</p><pre><span style="color: darkgreen">// Convert integer array to bytes and then encode.</span>
<span style="color: darkgreen">// Base64.NO_WRAP and Base64.NO_PADDING flags are mandatory for proper operation.</span>
public String b64encode(<span style="color: blue">int</span>[] params) {
      <span style="color: blue">if</span>(params.length == 0) {
              <span style="color: blue">return</span> <span style="color: darkred">""</span>;
      }
      ByteBuffer byteParams;
      byteParams = ByteBuffer.allocateDirect(4*params.length);
      byteParams.order(ByteOrder.LITTLE_ENDIAN);
      <span style="color: blue">for</span>(<span style="color: blue">int</span> i=0; i&lt;params.length; i++) {
              byteParams.putInt(params[i]);
      }
      byte[] bparams = new byte[4*params.length];
      <span style="color: blue">for</span>(<span style="color: blue">int</span> i=0;i&lt;4*params.length;i++) {
            bparams[i] = byteParams.get(i);
      }
      <span style="color: blue">return</span> Base64.encodeToString(bparams, 0, bparams.length, Base64.NO_WRAP | Base64.NO_PADDING);
}
<span style="color: darkgreen">//Converts received encoded data string to integers </span>
public <span style="color: blue">int</span>[] getDecodedParams(String keyvalue) {
   byte[] decParams = Base64.decode(keyvalue, Base64.NO_WRAP | Base64.NO_PADDING);
   ByteBuffer byteParams;
   byteParams = ByteBuffer.allocateDirect(decParams.length);
   byteParams.order(ByteOrder.LITTLE_ENDIAN);
   <span style="color: blue">int</span>[] iParams = new <span style="color: blue">int</span>[decParams.length];
   byteParams.put(decParams);
   <span style="color: blue">int</span> len=0;
   <span style="color: blue">for</span>(<span style="color: blue">int</span> i=0; i&lt;byteParams.limit(); i=i+4) {
        iParams[len] = byteParams.getInt(i);
        len++;
   }
   <span style="color: blue">return</span> iParams;
}
<span style="color: darkgreen">// Get value for a given key from "key1=value1;..." pairs</span>
public String getValueByKey(String key, String keyValuePairs) {
   String[] res;
   String[] sparams = keyValuePairs.split(<span style="color: darkred">";"</span>);
   <span style="color: blue">for</span>(<span style="color: blue">int</span> i=0; i&lt;sparams.length; i++) {
     res = sparams[i].split(<span style="color: darkred">"="</span>);
     <span style="color: blue">if</span>(res[0].equalsIgnoreCase(key)) {
       <span style="color: blue">return</span> res[1];
     }
   }
   <span style="color: blue">return</span> <span style="color: darkred">""</span>;
}
</pre><h3>
<a name="Set%20data%20of%20one%20parameter"></a>Set data of one parameter
</h3><p>
Say, param_id (0x10001112), module_id (0x10001111).
</p><p>
Setting two volume levels of a current active audio playback session.
</p><pre><span style="color: blue">int</span>[] param_data = [0x4000, 0x8000]; <span style="color: darkgreen">// volume1 and volume 2</span>
String value = b64encode(param_data);

String key= <span style="color: darkred">"cal_persist=0;cal_devid=2;cal_apptype=69936;cal_caltype=0;cal_samplerate=48000;cal_topoid=0x10000001;cal_moduleid=0x10001111;cal_paramid=0x10001112;"</span>;
key = key + <span style="color: darkred">"cal_data="</span>;
key = key + value;
AudioManager aManager=(AudioManager)getSystemService(Context.AUDIO_SERVICE);
aManager.setParameters(key);
</pre><h3>
<a name="Set%20data%20of%20multiple%20parameters"></a>Set data of multiple parameters
</h3><p>
Set gain and enable parameters of module1 and filter coeff of module2.
</p><p>
Say filter coefficients of length 16 bytes with data [0xA1A2A3A4, 0xA5A6A7A8, 0xB1B2B3B4, 0xB5B6B7B8]
</p><pre><span style="color: darkgreen">// module 1 </span>
<span style="color: blue">int</span> module_id1  = 0x10001111;
<span style="color: blue">int</span> gain_id1    = 0x10000001;
<span style="color: blue">int</span> gain_data   = 0x4000;
<span style="color: blue">int</span> enable_id1  = 0x10000002;
<span style="color: blue">int</span> enable_data = 1;
<span style="color: darkgreen">// module 2</span>
<span style="color: blue">int</span> module_id2  = 0x10002222;
<span style="color: blue">int</span> filter_id1  = 0x10000003; 

<span style="color: darkgreen">// Data format is explained in setParameters() API</span>
<span style="color: darkgreen">// Data format - MODULE#1, PARAMID#1, RESERVED | LENGTH, DATA, MODULE#2, PARAMID#1, RESERVED | LENGTH, DATA...</span>
<span style="color: blue">int</span>[] data = [module_id1, gain_id1, 4, gain_data, module_id1, enable_id1, 4, enable_data, module_id2, filter_id1, 16, 0xA1A2A3A4, 0xA5A6A7A8, 0xB1B2B3B4, 0xB5B6B7B8]
String value = b64encode(data);

String key= <span style="color: darkred">"cal_persist=0;cal_devid=2;cal_apptype=69936;cal_caltype=0;cal_samplerate=48000;cal_topoid=0x10000001;"</span>;
key = key + <span style="color: darkred">"cal_data="</span>;
key = key + value;
AudioManager aManager=(AudioManager)getSystemService(Context.AUDIO_SERVICE);
aManager.setParameters(key);
</pre><h3>
<a name="Get%20a%20parameter"></a>Get a parameter
</h3><p>
Get a volume parameter from ACDB
</p><p>
cal_persist=1; // persit
</p><p>
cal_devid=2; //speaker
</p><p>
cal_apptype=69936; //audio playback
</p><p>
cal_caltype=0; //COPP
</p><p>
cal_topoid=0x10313 //topology id, associated to device in QACT
</p><p>
cal_moduleid=0x10C38;
</p><p>
cal_param_id=0x10C37;
</p><pre><span style="color: darkgreen">// Get volume </span>
String key = <span style="color: darkred">"cal_persist=1;cal_devid=2;cal_apptype=69936;cal_caltype=0;cal_samplerate=48000;cal_topoid=0x10313;cal_moduleid=0x10C37;cal_paramid=0x10C38;cal_data=0"</span>;
AudioManager aManager=(AudioManager)getSystemService(Context.AUDIO_SERVICE);  
String rcv_params = aManager.getParameters(key);
String value = getValueByKey(<span style="color: darkred">"cal_data"</span>, rcv_params);
<span style="color: blue">int</span>[] final_params = getDecodedParams(value); <span style="color: darkgreen">// final_params stores the volume</span>
</pre><h2>
<a name="Test%20Application"></a>Test Application
</h2><p>
Audio Calibration Test application (audiocal.apk) is available in SDK for trying set/get parameters interface. This application is useful for quick testing and giving demos. HAP customers can directly use these methods to develop new media applications of interest.
</p><p>
The test application imports the user configuration from /data/audiocal.xml file.
</p><p>
Configuration XML file stores the device, topology, module and parameters information. Users can modify and import the configurable parameters to select.
</p><left><img alt="<Image not found&gt;" src="images/audiocal_app.png"></left><p>
Follow the simple steps to try an application.
</p><ol class="indent" type="1">
<li>
<p>
Install audiocal.apk
</p><pre>cd &lt;HEXAGON_SDK_ROOT&gt;/lib/audio/audiocal/
adb install audiocal.apk
adb root
</pre>
</li><li>
<p>
Edit &lt;HEXAGON_SDK_ROOT&gt;/lib/audio/audiocal/audiocal.xml with custom module information
</p>
</li><li>
<p>
push audiocal.xml to /data
</p><pre>cd &lt;HEXAGON_SDK_ROOT&gt;/lib/audio/audiocal
adb push audiocal.xml /data
</pre>
</li><li>
<p>
Launch &#8220;Audiocal&#8221; application on Android phone
</p>
</li><li>
<p>
Click &#8220;Load Audio Cal Database&#8221; button to import data from /data/audiocal.xml file
</p>
</li><li>
<p>
Select configurable parameters, Say
</p><pre>Device   = AUDIO_DEVICE_OUT_SPEAKER
AppType  = AUDIO_PLAYBACK
calType  = AUDIO_COPP
Sampling = 48000
Topology = speaker_copp_mono_audio
Module   = codec_gain_ctrl
Params   = rx_codec_gain
Persist  = select checkbox
</pre>
</li><li>
<p>
Click &#8220;Get&#8221; to receive &#8220;rx_codec_gain&#8221; from ACDB. Received parameters will be displayed below the Get button.
</p>
</li><li>
<p>
Play any audio file
</p>
</li><li>
<p>
Select same configuration and remove checkbox for Persist
</p>
</li><li>
<p>
Click &#8220;Get&#8221; to receive &#8220;rx_codec_gain&#8221; from &#8220;speaker_copp_mono_audio&#8221; topology in ADSP COPP
</p>
</li>
</ol><p>
NOTE: Check logcat for more information.
</p><div class="indent"><pre>adb logcat -s <span style="color: darkred">"rtclog"</span>
</pre></div><h2>
<a name="Quick%20FAQ"></a>Quick FAQ
</h2><ol type="1">
<li>
<p>
Is setParameters() method returns status (success/failure)?
</p><div class="indent"><p>
No. setParameters in Android Manager don't return status of the call. You need to do 'Get' after 'Set' and verify the data received.
</p></div>
</li><li>
<p>
Is it possible to add new parameter with unique ID to ACDB using this interface?
</p><div class="indent"><p>
No. This interface only allows to replace the existing parameters in ACDB when used wit persist option. You need to use QACT/QACT_Lite tool to add new parameter and then use this interface to modify it at run time from java application.
</p></div>
</li><li>
<p>
Is this interface supports calibration of voice modules?
</p><div class="indent"><p>
No. Currently voice is not supported.
</p></div>
</li><li>
<p>
Parameters failed to persist after reboot?
</p><div class="indent"><p>
Parameters set using persist option are stored in acdb files created at run time. Mostly creation of these files failed due to lack of access to media server. Fix is already released in later APPS builds, moving to latest APPS build helps.
</p></div>
</li>
</ol><p align="center" style="display:block;padding-top: 50px;">
  Copyright &#169; 2018 Qualcomm Technologies Inc. All rights reserved.

</p><a style="display:block;padding-bottom: 700px;"></a></div></div>
</body>
</html>
